<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de V√≠deos Autom√°tico - Pixabay</title>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.7/dist/umd/ffmpeg.js"></script>
    <script src="https://unpkg.com/@ffmpeg/util@0.12.1/dist/index.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .input-section {
            background: #f8fafc;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid #e2e8f0;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 1.1rem;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #d1d5db;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-row-three {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .generate-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }

        .generate-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .progress-section {
            background: #fef3c7;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid #f59e0b;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f59e0b, #d97706);
            width: 0%;
            transition: width 0.5s ease;
        }

        .status-text {
            font-weight: 600;
            color: #92400e;
            text-align: center;
        }

        .video-preview {
            background: #f1f5f9;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            display: none;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .video-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .video-item:hover {
            transform: translateY(-5px);
        }

        .video-item video {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .video-item h4 {
            color: #374151;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .video-item p {
            color: #6b7280;
            font-size: 0.8rem;
        }

        .download-section {
            background: #ecfdf5;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            border: 2px solid #10b981;
            display: none;
        }

        .download-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 10px;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(16, 185, 129, 0.3);
        }

        .error-message {
            background: #fef2f2;
            border: 2px solid #f87171;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            color: #dc2626;
            display: none;
        }

        .success-message {
            background: #ecfdf5;
            border: 2px solid #10b981;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            color: #059669;
            display: none;
        }

        .tips-section {
            background: #eff6ff;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border-left: 5px solid #3b82f6;
        }

        .tips-section h3 {
            color: #1e40af;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .tips-section ul {
            color: #1e40af;
            padding-left: 20px;
        }

        .tips-section li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            display: none;
        }

        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .form-row, .form-row-three {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .main-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3>Carregando FFmpeg...</h3>
            <p>Aguarde, estamos preparando o sistema de edi√ß√£o de v√≠deo.</p>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üé¨ Gerador de V√≠deos Autom√°tico</h1>
            <p>Crie v√≠deos incr√≠veis de at√© 50 minutos usando conte√∫do gratuito do Pixabay</p>
        </div>

        <div class="main-content">
            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>

            <div class="input-section">
                <h2 style="color: #374151; margin-bottom: 25px; font-size: 1.5rem;">‚öôÔ∏è Configura√ß√µes do V√≠deo</h2>
                
                <div class="form-group">
                    <label for="apiKey">üîë Chave da API do Pixabay:</label>
                    <input type="password" id="apiKey" placeholder="48429608-b91af5e838d3efacf96128eac" value="48429608-b91af5e838d3efacf96128eac">
                    <small style="color: #6b7280; margin-top: 5px; display: block;">
                        <a href="https://pixabay.com/api/docs/" target="_blank" style="color: #4f46e5;">Clique aqui para obter sua chave gratuita</a>
                    </small>
                </div>

                <div class="form-group">
                    <label for="keywords">üîç Palavras-chave (separadas por v√≠rgula):</label>
                    <textarea id="keywords" rows="3" placeholder="nature, ocean, mountain, forest, sunset">nature, ocean, mountain</textarea>
                </div>

                <div class="form-row-three">
                    <div class="form-group">
                        <label for="totalDuration">‚è±Ô∏è Dura√ß√£o Total (minutos):</label>
                        <input type="number" id="totalDuration" value="1" min="1" max="50">
                    </div>
                    <div class="form-group">
                        <label for="clipDuration">üé¨ Dura√ß√£o por Clipe (segundos):</label>
                        <select id="clipDuration">
                            <option value="5">5 segundos</option>
                            <option value="10" selected>10 segundos</option>
                            <option value="15">15 segundos</option>
                            <option value="20">20 segundos</option>
                            <option value="30">30 segundos</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="videosPerKeyword">üìπ V√≠deos por Palavra:</label>
                        <input type="number" id="videosPerKeyword" value="2" min="1" max="5">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="videoQuality">üì∫ Qualidade do V√≠deo:</label>
                        <select id="videoQuality">
                            <option value="large">HD (1280x720)</option>
                            <option value="medium" selected>SD (640x360)</option>
                            <option value="small">Baixa (480x270)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transitionDuration">üé® Dura√ß√£o da Transi√ß√£o (segundos):</label>
                        <select id="transitionDuration">
                            <option value="0.5">0.5 segundos</option>
                            <option value="1" selected>1 segundo</option>
                            <option value="1.5">1.5 segundos</option>
                            <option value="2">2 segundos</option>
                        </select>
                    </div>
                </div>

                <button class="generate-btn" onclick="generateVideo()" id="generateBtn">
                    üöÄ Gerar V√≠deo Autom√°tico
                </button>
            </div>

            <div class="progress-section" id="progressSection">
                <h3 style="color: #92400e; margin-bottom: 15px;">üîÑ Gerando seu v√≠deo...</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="status-text" id="statusText">Iniciando...</div>
            </div>

            <div class="video-preview" id="videoPreview">
                <h3 style="color: #374151; margin-bottom: 20px;">üìπ V√≠deos Encontrados</h3>
                <div class="preview-grid" id="previewGrid"></div>
            </div>

            <div class="download-section" id="downloadSection">
                <h3 style="color: #059669; margin-bottom: 20px;">‚úÖ V√≠deo Pronto!</h3>
                <p style="color: #374151; margin-bottom: 20px;">Seu v√≠deo foi gerado com sucesso!</p>
                <video controls style="max-width: 100%; height: 300px; border-radius: 10px; margin-bottom: 20px;" id="finalVideo"></video>
                <div>
                    <p style="color: #6b7280; margin-bottom: 15px;" id="videoInfo"></p>
                    <button class="download-btn" onclick="downloadVideo()">üì• Baixar V√≠deo</button>
                    <button class="download-btn" onclick="generateAnother()" style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);">üîÑ Gerar Outro</button>
                </div>
            </div>

            <div class="tips-section">
                <h3>üí° Dicas para Melhores Resultados:</h3>
                <ul>
                    <li><strong>Palavras-chave:</strong> Use termos em ingl√™s para melhores resultados (ex: "nature", "ocean", "mountain")</li>
                    <li><strong>Dura√ß√£o:</strong> Para v√≠deos longos, use mais palavras-chave e clipes mais curtos</li>
                    <li><strong>Qualidade:</strong> SD √© recomendado para testes r√°pidos, HD para resultado final</li>
                    <li><strong>Transi√ß√µes:</strong> 1 segundo √© ideal para a maioria dos casos</li>
                    <li><strong>Performance:</strong> Teste com v√≠deos curtos primeiro (1-2 minutos)</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const { FFmpeg } = FFmpegWASM;
        const { fetchFile } = FFmpegUtil;
        
        let ffmpeg = null;
        let currentVideos = [];
        let finalVideoBlob = null;
        let isFFmpegLoaded = false;

        // Inicializar FFmpeg
        async function initFFmpeg() {
            if (isFFmpegLoaded) return;
            
            document.getElementById('loadingOverlay').style.display = 'flex';
            
            try {
                ffmpeg = new FFmpeg();
                
                ffmpeg.on('log', ({ message }) => {
                    console.log('FFmpeg:', message);
                });
                
                ffmpeg.on('progress', ({ progress }) => {
                    if (progress > 0) {
                        const percent = Math.round(progress * 100);
                        updateProgress(70 + (percent * 0.25), `Processando v√≠deo: ${percent}%`);
                    }
                });
                
                await ffmpeg.load();
                isFFmpegLoaded = true;
                
                document.getElementById('loadingOverlay').style.display = 'none';
                showSuccess('Sistema carregado com sucesso! Pronto para gerar v√≠deos.');
                
            } catch (error) {
                console.error('Erro ao carregar FFmpeg:', error);
                document.getElementById('loadingOverlay').style.display = 'none';
                showError('Erro ao carregar o sistema de edi√ß√£o. Tente recarregar a p√°gina.');
            }
        }

        // Chamar ao carregar a p√°gina
        window.addEventListener('load', initFFmpeg);

        async function generateVideo() {
            if (!isFFmpegLoaded) {
                showError('O sistema ainda est√° carregando. Aguarde alguns segundos.');
                return;
            }

            const apiKey = document.getElementById('apiKey').value.trim();
            const keywords = document.getElementById('keywords').value.trim();
            const totalDuration = parseInt(document.getElementById('totalDuration').value);
            const clipDuration = parseInt(document.getElementById('clipDuration').value);
            const videosPerKeyword = parseInt(document.getElementById('videosPerKeyword').value);
            const videoQuality = document.getElementById('videoQuality').value;
            const transitionDuration = parseFloat(document.getElementById('transitionDuration').value);

            // Valida√ß√£o
            if (!apiKey) {
                showError('Por favor, insira sua chave da API do Pixabay');
                return;
            }

            if (!keywords) {
                showError('Por favor, insira pelo menos uma palavra-chave');
                return;
            }

            // Calcular quantos clipes s√£o necess√°rios
            const totalSeconds = totalDuration * 60;
            const clipsNeeded = Math.ceil(totalSeconds / clipDuration);

            // Mostrar progresso
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('progressSection').style.display = 'block';
            document.getElementById('videoPreview').style.display = 'none';
            document.getElementById('downloadSection').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';

            try {
                // Dividir palavras-chave
                const keywordList = keywords.split(',').map(k => k.trim()).filter(k => k);
                
                updateProgress(10, 'Buscando v√≠deos...');
                
                // Buscar v√≠deos para cada palavra-chave
                currentVideos = [];
                for (let i = 0; i < keywordList.length; i++) {
                    const keyword = keywordList[i];
                    updateProgress(10 + (i * 20) / keywordList.length, `Buscando v√≠deos para: ${keyword}`);
                    
                    const videos = await searchVideos(apiKey, keyword, videosPerKeyword, videoQuality);
                    currentVideos = currentVideos.concat(videos);
                }

                if (currentVideos.length === 0) {
                    showError('Nenhum v√≠deo encontrado para as palavras-chave fornecidas');
                    return;
                }

                // Limitar aos clipes necess√°rios
                currentVideos = currentVideos.slice(0, clipsNeeded);

                updateProgress(40, `Encontrados ${currentVideos.length} v√≠deos. Baixando...`);
                
                // Mostrar preview dos v√≠deos
                displayVideoPreview(currentVideos);
                
                // Baixar v√≠deos
                const videoBlobs = await downloadVideos(currentVideos);
                
                updateProgress(70, 'Processando v√≠deos...');
                
                // Criar v√≠deo final
                finalVideoBlob = await createFinalVideo(videoBlobs, clipDuration, transitionDuration, totalDuration);
                
                updateProgress(100, 'V√≠deo conclu√≠do!');
                
                // Mostrar resultado
                setTimeout(() => {
                    document.getElementById('progressSection').style.display = 'none';
                    document.getElementById('downloadSection').style.display = 'block';
                    
                    const finalVideoElement = document.getElementById('finalVideo');
                    finalVideoElement.src = URL.createObjectURL(finalVideoBlob);
                    
                    // Mostrar informa√ß√µes do v√≠deo
                    const videoInfo = document.getElementById('videoInfo');
                    videoInfo.textContent = `V√≠deo gerado: ${currentVideos.length} clipes, ${Math.round(finalVideoBlob.size / 1024 / 1024 * 100) / 100} MB`;
                    
                    showSuccess('V√≠deo gerado com sucesso! Voc√™ pode visualizar e baixar abaixo.');
                    
                }, 1000);

            } catch (error) {
                console.error('Erro:', error);
                showError('Erro ao gerar v√≠deo: ' + error.message);
                document.getElementById('progressSection').style.display = 'none';
            } finally {
                document.getElementById('generateBtn').disabled = false;
            }
        }

        async function searchVideos(apiKey, keyword, count, quality) {
            const url = `https://pixabay.com/api/videos/?key=${apiKey}&q=${encodeURIComponent(keyword)}&per_page=${count}&safesearch=true&order=popular&min_width=640&min_height=360`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Erro na API do Pixabay');
                }
                
                return data.hits.map(video => ({
                    id: video.id,
                    tags: video.tags,
                    duration: video.duration,
                    url: video.videos[quality]?.url || video.videos.large?.url || video.videos.medium?.url,
                    preview: video.videos.tiny?.url,
                    user: video.user,
                    width: video.videos[quality]?.width || 640,
                    height: video.videos[quality]?.height || 360
                })).filter(video => video.url);
                
            } catch (error) {
                console.error('Erro ao buscar v√≠deos:', error);
                throw error;
            }
        }

        async function downloadVideos(videos) {
            const videoBlobs = [];
            
            for (let i = 0; i < videos.length; i++) {
                const video = videos[i];
                updateProgress(40 + (i * 25) / videos.length, `Baixando v√≠deo ${i + 1}/${videos.length}`);
                
                try {
                    const response = await fetch(video.url);
                    if (!response.ok) {
                        throw new Error(`Erro ao baixar v√≠deo: ${response.status}`);
                    }
                    const blob = await response.blob();
                    videoBlobs.push(blob);
                } catch (error) {
                    console.error('Erro ao baixar v√≠deo:', error);
                    // Continuar com outros v√≠deos
                }
            }
            
            return videoBlobs;
        }

        function displayVideoPreview(videos) {
            const previewGrid = document.getElementById('previewGrid');
            previewGrid.innerHTML = '';
            
            videos.forEach((video, index) => {
                const videoItem = document.createElement('div');
                videoItem.className = 'video-item';
                
                // Criar elemento de v√≠deo para preview
                const videoElement = document.createElement('video');
                videoElement.src = video.url;
                videoElement.muted = true;
                videoElement.controls = true;
                videoElement.style.width = '100%';
                videoElement.style.height = '150px';
                videoElement.style.objectFit = 'cover';
                videoElement.style.borderRadius = '8px';
                videoElement.style.marginBottom = '10px';
                
                const title = document.createElement('h4');
                title.textContent = `V√≠deo ${index + 1}`;
                title.style.color = '#374151';
                title.style.fontSize = '0.9rem';
                title.style.marginBottom = '5px';
                
                const info = document.createElement('p');
                info.innerHTML = `
                    <strong>Tags:</strong> ${video.tags}<br>
                    <strong>Dura√ß√£o:</strong> ${video.duration}s<br>
                    <strong>Resolu√ß√£o:</strong> ${video.width}x${video.height}
                `;
                info.style.color = '#6b7280';
                info.style.fontSize = '0.8rem';
                
                videoItem.appendChild(videoElement);
                videoItem.appendChild(title);
                videoItem.appendChild(info);
                previewGrid.appendChild(videoItem);
            });
            
            document.getElementById('videoPreview').style.display = 'block';
        }

        async function createFinalVideo(videoBlobs, clipDuration, transitionDuration, totalDurationMinutes) {
            if (!ffmpeg || videoBlobs.length === 0) {
                throw new Error('FFmpeg n√£o carregado ou nenhum v√≠deo dispon√≠vel');
            }
            
            try {
                updateProgress(75, 'Preparando arquivos...');
                
                // Escrever v√≠deos no sistema de arquivos virtual do FFmpeg
                const inputFiles = [];
                for (let i = 0; i < videoBlobs.length; i++) {
                    const filename = `input${i}.mp4`;
                    await ffmpeg.writeFile(filename, await fetchFile(videoBlobs[i]));
                    inputFiles.push(filename);
                }
                
                updateProgress(80, 'Criando lista de concatena√ß√£o...');
                
                // Criar arquivo de concatena√ß√£o
                let concatList = '';
                for (let i = 0; i < inputFiles.length; i++) {
                    concatList += `file '${inputFiles[i]}'\n`;
                }
                await ffmpeg.writeFile('concat_list.txt', concatList);
                
                updateProgress(85, 'Processando v√≠deo final...');
                
                // Executar FFmpeg para concatenar os v√≠deos
                const outputFilename = 'output_final.mp4';
                
                await ffmpeg.exec([
                    '-f', 'concat',
                    '-safe', '0',
                    '-i', 'concat_list.txt',
                    '-c', 'copy',
                    '-avoid_negative_ts', 'make_zero',
                    outputFilename
                ]);
                
                updateProgress(95, 'Finalizando...');
                
                // Ler o arquivo de sa√≠da
                const outputData = await ffmpeg.readFile(outputFilename);
                
                // Limpar arquivos tempor√°rios
                for (const filename of inputFiles) {
                    try {
                        await ffmpeg.deleteFile(filename);
                    } catch (e) {
                        console.log('Erro ao deletar arquivo:', e);
                    }
                }
                
                try {
                    await ffmpeg.deleteFile('concat_list.txt');
                    await ffmpeg.deleteFile(outputFilename);
                } catch (e) {
                    console.log('Erro ao deletar arquivos tempor√°rios:', e);
                }
                
                return new Blob([outputData], { type: 'video/mp4' });
                
            } catch (error) {
                console.error('Erro ao criar v√≠deo final:', error);
                throw new Error('Erro ao processar v√≠deo: ' + error.message);
            }
        }

        function updateProgress(percent, status) {
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('statusText').textContent = status;
        }

        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            
            setTimeout(() => {
                errorElement.style.display = 'none';
            }, 8000);
        }

        function showSuccess(message) {
            const successElement = document.getElementById('successMessage');
            successElement.textContent = message;
            successElement.style.display = 'block';
            
            setTimeout(() => {
                successElement.style.display = 'none';
            }, 5000);
        }

        function downloadVideo() {
            if (finalVideoBlob) {
                const url = URL.createObjectURL(finalVideoBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `video_gerado_${new Date().toISOString().slice(0,19).replace(/:/g, '-')}.mp4`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }

        function generateAnother() {
            // Resetar interface
            document.getElementById('progressSection').style.display = 'none';
            document.getElementById('videoPreview').style.display = 'none';
            document.getElementById('downloadSection').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            
            // Limpar dados
           currentVideos = [];
           finalVideoBlob = null;
           
           // Resetar formul√°rio
           document.getElementById('progressFill').style.width = '0%';
           document.getElementById('statusText').textContent = 'Iniciando...';
           document.getElementById('previewGrid').innerHTML = '';
           document.getElementById('generateBtn').disabled = false;
           
           // Focar no campo de palavras-chave
           document.getElementById('keywords').focus();
           document.getElementById('keywords').select();
           
           // Scroll para o topo
           document.querySelector('.input-section').scrollIntoView({ 
               behavior: 'smooth', 
               block: 'start' 
           });
       }

       // Fun√ß√£o para validar URL de v√≠deo
       function isValidVideoUrl(url) {
           return url && (url.includes('.mp4') || url.includes('.webm') || url.includes('.avi'));
       }

       // Fun√ß√£o para calcular dura√ß√£o total estimada
       function calculateEstimatedDuration() {
           const totalDuration = parseInt(document.getElementById('totalDuration').value);
           const clipDuration = parseInt(document.getElementById('clipDuration').value);
           const transitionDuration = parseFloat(document.getElementById('transitionDuration').value);
           
           const totalSeconds = totalDuration * 60;
           const clipsNeeded = Math.ceil(totalSeconds / clipDuration);
           const totalTransitionTime = (clipsNeeded - 1) * transitionDuration;
           const actualDuration = (clipsNeeded * clipDuration) + totalTransitionTime;
           
           return {
               clipsNeeded,
               totalTransitionTime,
               actualDuration: Math.round(actualDuration)
           };
       }

       // Atualizar informa√ß√µes em tempo real
       function updateDurationInfo() {
           const info = calculateEstimatedDuration();
           const infoElement = document.getElementById('durationInfo');
           
           if (infoElement) {
               infoElement.textContent = `Ser√£o necess√°rios ${info.clipsNeeded} clipes (dura√ß√£o estimada: ${Math.round(info.actualDuration / 60)} min ${info.actualDuration % 60} seg)`;
           }
       }

       // Fun√ß√£o para limpar cache do FFmpeg
       async function clearFFmpegCache() {
           if (ffmpeg) {
               try {
                   // Listar arquivos no sistema de arquivos do FFmpeg
                   const files = await ffmpeg.listDir('/');
                   
                   // Deletar arquivos tempor√°rios
                   for (const file of files) {
                       if (file.name.includes('input') || file.name.includes('output') || file.name.includes('concat')) {
                           try {
                               await ffmpeg.deleteFile(file.name);
                           } catch (e) {
                               console.log('Arquivo j√° deletado:', file.name);
                           }
                       }
                   }
               } catch (error) {
                   console.log('Erro ao limpar cache:', error);
               }
           }
       }

       // Fun√ß√£o para verificar suporte do navegador
       function checkBrowserSupport() {
           const isSupported = typeof WebAssembly !== 'undefined' && 
                              typeof SharedArrayBuffer !== 'undefined' && 
                              typeof Worker !== 'undefined';
           
           if (!isSupported) {
               showError('Seu navegador n√£o suporta todas as funcionalidades necess√°rias. Recomendamos usar Chrome ou Firefox mais recente.');
               return false;
           }
           
           return true;
       }

       // Fun√ß√£o para otimizar v√≠deo antes do processamento
       async function optimizeVideo(videoBlob, index, clipDuration) {
           const filename = `input${index}.mp4`;
           const optimizedFilename = `optimized${index}.mp4`;
           
           try {
               // Escrever v√≠deo original
               await ffmpeg.writeFile(filename, await fetchFile(videoBlob));
               
               // Otimizar v√≠deo (redimensionar, cortar dura√ß√£o)
               await ffmpeg.exec([
                   '-i', filename,
                   '-t', clipDuration.toString(),
                   '-vf', 'scale=640:360,fps=30',
                   '-c:v', 'libx264',
                   '-crf', '28',
                   '-preset', 'fast',
                   '-c:a', 'aac',
                   '-b:a', '128k',
                   optimizedFilename
               ]);
               
               // Ler v√≠deo otimizado
               const optimizedData = await ffmpeg.readFile(optimizedFilename);
               
               // Limpar arquivos tempor√°rios
               await ffmpeg.deleteFile(filename);
               await ffmpeg.deleteFile(optimizedFilename);
               
               return new Blob([optimizedData], { type: 'video/mp4' });
               
           } catch (error) {
               console.error('Erro ao otimizar v√≠deo:', error);
               // Retornar v√≠deo original se otimiza√ß√£o falhar
               return videoBlob;
           }
       }

       // Fun√ß√£o para criar v√≠deo com transi√ß√µes suaves
       async function createVideoWithTransitions(videoBlobs, clipDuration, transitionDuration) {
           if (!ffmpeg || videoBlobs.length === 0) {
               throw new Error('FFmpeg n√£o carregado ou nenhum v√≠deo dispon√≠vel');
           }
           
           try {
               updateProgress(75, 'Otimizando v√≠deos...');
               
               // Otimizar cada v√≠deo
               const optimizedBlobs = [];
               for (let i = 0; i < videoBlobs.length; i++) {
                   updateProgress(75 + (i * 10) / videoBlobs.length, `Otimizando v√≠deo ${i + 1}/${videoBlobs.length}`);
                   const optimized = await optimizeVideo(videoBlobs[i], i, clipDuration);
                   optimizedBlobs.push(optimized);
               }
               
               updateProgress(85, 'Criando transi√ß√µes...');
               
               // Escrever v√≠deos otimizados
               const inputFiles = [];
               for (let i = 0; i < optimizedBlobs.length; i++) {
                   const filename = `clip${i}.mp4`;
                   await ffmpeg.writeFile(filename, await fetchFile(optimizedBlobs[i]));
                   inputFiles.push(filename);
               }
               
               // Criar filtro complexo para transi√ß√µes
               let filterComplex = '';
               let inputs = '';
               
               for (let i = 0; i < inputFiles.length; i++) {
                   inputs += `-i ${inputFiles[i]} `;
                   
                   if (i === 0) {
                       filterComplex += `[0:v]fade=t=in:st=0:d=${transitionDuration}[v0]; `;
                   } else if (i === inputFiles.length - 1) {
                       filterComplex += `[${i}:v]fade=t=out:st=${clipDuration - transitionDuration}:d=${transitionDuration}[v${i}]; `;
                   } else {
                       filterComplex += `[${i}:v]fade=t=in:st=0:d=${transitionDuration},fade=t=out:st=${clipDuration - transitionDuration}:d=${transitionDuration}[v${i}]; `;
                   }
               }
               
               // Concatenar v√≠deos com transi√ß√µes
               for (let i = 0; i < inputFiles.length; i++) {
                   filterComplex += `[v${i}][${i}:a]`;
               }
               filterComplex += `concat=n=${inputFiles.length}:v=1:a=1[outv][outa]`;
               
               updateProgress(90, 'Processando v√≠deo final...');
               
               const outputFilename = 'final_with_transitions.mp4';
               
               // Executar FFmpeg com filtro complexo
               await ffmpeg.exec([
                   ...inputs.trim().split(' '),
                   '-filter_complex', filterComplex,
                   '-map', '[outv]',
                   '-map', '[outa]',
                   '-c:v', 'libx264',
                   '-crf', '23',
                   '-preset', 'medium',
                   '-c:a', 'aac',
                   '-b:a', '128k',
                   outputFilename
               ]);
               
               updateProgress(95, 'Finalizando...');
               
               // Ler arquivo final
               const outputData = await ffmpeg.readFile(outputFilename);
               
               // Limpar arquivos tempor√°rios
               for (const filename of inputFiles) {
                   try {
                       await ffmpeg.deleteFile(filename);
                   } catch (e) {
                       console.log('Erro ao deletar arquivo:', e);
                   }
               }
               
               try {
                   await ffmpeg.deleteFile(outputFilename);
               } catch (e) {
                   console.log('Erro ao deletar arquivo final:', e);
               }
               
               return new Blob([outputData], { type: 'video/mp4' });
               
           } catch (error) {
               console.error('Erro ao criar v√≠deo com transi√ß√µes:', error);
               // Fallback para concatena√ß√£o simples
               return await createFinalVideo(videoBlobs, clipDuration, transitionDuration);
           }
       }

       // Atualizar a fun√ß√£o createFinalVideo para usar transi√ß√µes
       async function createFinalVideo(videoBlobs, clipDuration, transitionDuration, totalDurationMinutes) {
           // Usar fun√ß√£o com transi√ß√µes se dispon√≠vel
           if (transitionDuration > 0) {
               return await createVideoWithTransitions(videoBlobs, clipDuration, transitionDuration);
           }
           
           // Concatena√ß√£o simples (c√≥digo anterior)
           if (!ffmpeg || videoBlobs.length === 0) {
               throw new Error('FFmpeg n√£o carregado ou nenhum v√≠deo dispon√≠vel');
           }
           
           try {
               updateProgress(75, 'Preparando arquivos...');
               
               const inputFiles = [];
               for (let i = 0; i < videoBlobs.length; i++) {
                   const filename = `input${i}.mp4`;
                   await ffmpeg.writeFile(filename, await fetchFile(videoBlobs[i]));
                   inputFiles.push(filename);
               }
               
               updateProgress(80, 'Criando lista de concatena√ß√£o...');
               
               let concatList = '';
               for (let i = 0; i < inputFiles.length; i++) {
                   concatList += `file '${inputFiles[i]}'\n`;
               }
               await ffmpeg.writeFile('concat_list.txt', concatList);
               
               updateProgress(85, 'Processando v√≠deo final...');
               
               const outputFilename = 'output_final.mp4';
               
               await ffmpeg.exec([
                   '-f', 'concat',
                   '-safe', '0',
                   '-i', 'concat_list.txt',
                   '-c', 'copy',
                   '-avoid_negative_ts', 'make_zero',
                   outputFilename
               ]);
               
               updateProgress(95, 'Finalizando...');
               
               const outputData = await ffmpeg.readFile(outputFilename);
               
               // Limpar arquivos tempor√°rios
               for (const filename of inputFiles) {
                   try {
                       await ffmpeg.deleteFile(filename);
                   } catch (e) {
                       console.log('Erro ao deletar arquivo:', e);
                   }
               }
               
               try {
                   await ffmpeg.deleteFile('concat_list.txt');
                   await ffmpeg.deleteFile(outputFilename);
               } catch (e) {
                   console.log('Erro ao deletar arquivos tempor√°rios:', e);
               }
               
               return new Blob([outputData], { type: 'video/mp4' });
               
           } catch (error) {
               console.error('Erro ao criar v√≠deo final:', error);
               throw new Error('Erro ao processar v√≠deo: ' + error.message);
           }
       }

       // Adicionar event listeners para atualiza√ß√µes em tempo real
       document.addEventListener('DOMContentLoaded', function() {
           // Verificar suporte do navegador
           if (!checkBrowserSupport()) {
               return;
           }
           
           // Adicionar informa√ß√µes de dura√ß√£o
           const durationSection = document.querySelector('.form-row-three');
           if (durationSection) {
               const infoDiv = document.createElement('div');
               infoDiv.style.gridColumn = '1 / -1';
               infoDiv.style.marginTop = '10px';
               infoDiv.style.padding = '10px';
               infoDiv.style.background = '#f0f9ff';
               infoDiv.style.borderRadius = '8px';
               infoDiv.style.fontSize = '0.9rem';
               infoDiv.style.color = '#0369a1';
               infoDiv.id = 'durationInfo';
               durationSection.appendChild(infoDiv);
               
               // Atualizar informa√ß√µes quando valores mudarem
               const durationInputs = ['totalDuration', 'clipDuration', 'transitionDuration'];
               durationInputs.forEach(id => {
                   const element = document.getElementById(id);
                   if (element) {
                       element.addEventListener('input', updateDurationInfo);
                       element.addEventListener('change', updateDurationInfo);
                   }
               });
               
               // Atualizar informa√ß√µes iniciais
               updateDurationInfo();
           }
           
           console.log('üé¨ Sistema de Gera√ß√£o de V√≠deos Autom√°tico carregado com sucesso!');
           console.log('üìù Funcionalidades dispon√≠veis:');
           console.log('   ‚Ä¢ Busca autom√°tica no Pixabay');
           console.log('   ‚Ä¢ Processamento com FFmpeg');
           console.log('   ‚Ä¢ Transi√ß√µes suaves');
           console.log('   ‚Ä¢ Otimiza√ß√£o autom√°tica');
           console.log('   ‚Ä¢ Download direto');
       });

       // Fun√ß√£o para salvar configura√ß√µes no localStorage
       function saveSettings() {
           const settings = {
               apiKey: document.getElementById('apiKey').value,
               videoQuality: document.getElementById('videoQuality').value,
               clipDuration: document.getElementById('clipDuration').value,
               transitionDuration: document.getElementById('transitionDuration').value,
               videosPerKeyword: document.getElementById('videosPerKeyword').value
           };
           
           localStorage.setItem('videoGeneratorSettings', JSON.stringify(settings));
       }

       // Fun√ß√£o para carregar configura√ß√µes do localStorage
       function loadSettings() {
           const saved = localStorage.getItem('videoGeneratorSettings');
           if (saved) {
               try {
                   const settings = JSON.parse(saved);
                   
                   Object.keys(settings).forEach(key => {
                       const element = document.getElementById(key);
                       if (element && settings[key]) {
                           element.value = settings[key];
                       }
                   });
               } catch (error) {
                   console.log('Erro ao carregar configura√ß√µes:', error);
               }
           }
       }

       // Carregar configura√ß√µes ao iniciar
       window.addEventListener('load', loadSettings);

       // Salvar configura√ß√µes quando mudarem
       ['apiKey', 'videoQuality', 'clipDuration', 'transitionDuration', 'videosPerKeyword'].forEach(id => {
           const element = document.getElementById(id);
           if (element) {
               element.addEventListener('change', saveSettings);
           }
       });
   </script>
</body>
</html>
